function mkGame(a,b){function c(b){console.log("touchstart",b),b.preventDefault(),mouseDown=!0;var c,e;if(c=b.touches[0].pageX,e=b.touches[0].pageY,boxId=parseInt(e/boxSize)*a+parseInt(c/boxSize),levelColor!=boxs[boxId].colorIndex&&movesC++,levelColor=boxs[boxId].colorIndex,2==boxs[boxId].state){for(i=1;i<level[levelColor].line.length;i++){var f=boxs[level[levelColor].line[i]];2!=f.state&&(f.state=0,f.colorIndex=-1)}level[levelColor].line=[boxId]}anyThing=!0,d(b)}function d(b){console.log("touchmove",b),b.preventDefault();var c,d;c=b.touches[0].pageX,d=b.touches[0].pageY;var e=parseInt(d/boxSize)*a+parseInt(c/boxSize);if(oldBox!=e&&mouseDown&&-1!=levelColor){var f=level[levelColor].line[level[levelColor].line.length-1];oldBox=e;var g=boxs[e];if(!anyThing&&f-a!=e&&f+a!=e&&(f-1!=e&&f+1!=e||parseInt(f/a)!=parseInt(e/a)))return;if(2==g.state&&(level[levelColor].line[0]==e||g.colorIndex!=levelColor||f-1!=e&&f+1!=e&&f-a!=e&&f+a!=e||(level[levelColor].line.push(e),mouseDown=!1)),1==g.state||2==g.state&&g.colorIndex==levelColor){newArray=[];var h=!1,i=level[g.colorIndex].line,j=g.colorIndex;for(o=0;o<i.length;o++)i[o]==e&&g.colorIndex!=levelColor&&(h=!0,oldBox=-1),h?2!=boxs[i[o]].state&&(boxs[i[o]].state=0,boxs[i[o]].colorIndex=-1):newArray.push(i[o]),i[o]==e&&(h=!0);level[j].line=newArray}else 0==g.state&&(g.state=1,g.colorIndex=levelColor,level[levelColor].line.push(e));liContext.clearRect(0,0,theSize,theSize);var k=0,l=0,m=!1,n=!1;FWSpeed=1;for(var o=0;o<level.length;o++){var p=level[o];if(0!=p.line.length){liContext.beginPath();var q=p.line[0],r=p.line[p.line.length-1],s=boxs[p.line[0]].points;liContext.moveTo(s[0]+HboxSize,s[1]+HboxSize),liContext.fillStyle=p.colorOpc,liContext.fillRect(s[0],s[1],boxSize,boxSize),k++;for(var t=1;t<p.line.length;t++){k++;var u=boxs[p.line[t]].points;liContext.lineTo(u[0]+HboxSize,u[1]+HboxSize),liContext.fillStyle=p.colorOpc,liContext.fillRect(u[0],u[1],boxSize,boxSize)}liContext.lineWidth=lineSize,liContext.lineCap="round",liContext.lineJoin="round",liContext.strokeStyle=p.color,liContext.stroke(),liContext.closePath();var v=p.comp;p.box[0]==q&&p.box[1]==r||p.box[0]==r&&p.box[1]==q?(p.comp=!0,FWSpeed+=.1,l++):p.comp=!1,0==v&&1==p.comp&&(m=!0),1==v&&0==p.comp&&(m=!1,n=!0)}}var w=Math.round(100*k/boxs.length);if(100==w&&l==level.length){if(compArray[idoArray]){var x=compArray[idoArray].split(":");(!x[1]||x[1]>movesC)&&(compArray[idoArray]=nowLevelNo+":"+movesC+":"+level.length)}else compArray.push(nowLevelNo+":"+movesC+":"+level.length);saveComp(),$("#levelCompS .title").html(level.length==movesC?"Perfect!":"Level complete!"),$("#levelCompS .desc").html("You completed the level in "+movesC+" moves."),$("#forwCS").val("next level"),$("#retrCS").css("display","block");var y="I've Completed Level "+(nowLevelNo-150*nowPackNo+1)+" ("+a+"X"+a+") in "+flowjson[nowPackNo][0].name+" & my total score : "+TScore+"!";addthis.update("share","title",y+" give a try"),$(".addthis_button_facebook,.addthis_button_google_plusone_share").attr("addthis:url","http://moh97.us/flow/share.php?msg="+encodeURIComponent(y)),addthis.toolbox("#share_score"),$("#share_score").css("display","block"),$("#keepCS").css("display","none"),$("#levelCompS").fadeIn("fast")}else l==level.length&&($("#levelCompS .title").html("Almost there..."),$("#levelCompS .desc").html("Fill the board with pipe to complete the level."),$("#forwCS").val("skip level"),$("#retrCS").css("display","none"),$("#share_score").css("display","none"),$("#keepCS").css("display","block"),$("#levelCompS").fadeIn("fast"));$("#Perc").html(w),anyThing=!1}}$("#Perc").html("0"),$("#movesC").html("0"),bgContext.clearRect(0,0,theSize,theSize),liContext.clearRect(0,0,theSize,theSize),idoArray=$("#levels a[data-lno='"+nowLevelNo+"']").attr("data-cano"),movesC=0,movesB=compArray[idoArray]?compArray[idoArray].split(":")[1]?compArray[idoArray].split(":")[1]:"-":"-",$("#movesB").html(movesB),FWSpeed=1,level=[],colors_d=["rgba(247,125,0,1)","rgba(0,0,255,1)","rgba(0,129,0,1)","rgba(239,239,0,1)","rgba(255,0,0,1)","rgba(0,255,255,1)","rgba(255,0,255,1)","rgba(164,45,41,1)","rgba(123,0,123,1)","rgba(255,255,255,1)","rgba(0,0,140,1)","rgba(0,125,123,1)","rgba(165,165,165,1)","rgba(0,255,0,1)","rgba(189,182,107,1)","rgba(255,20,148,1)"],boxSize=theSize/a,HboxSize=boxSize/2,lineSize=33*boxSize/100,CircSize=35*boxSize/100,boxs=[],mouseDown=!1,levelColor=-1,oldBox=-1,anyThing=!1,offsetLeft=liCanvas.parentElement.offsetLeft,offsetTop=liCanvas.parentElement.offsetTop,bgContext.beginPath();for(var e=0;a>e;e++){bgContext.moveTo(e*boxSize,0),bgContext.lineTo(e*boxSize,theSize),bgContext.moveTo(0,e*boxSize),bgContext.lineTo(theSize,e*boxSize);for(var f=0;a>f;f++)boxs.push({state:0,colorIndex:-1,points:[f*boxSize,e*boxSize,(f+1)*boxSize,(e+1)*boxSize]})}bgContext.moveTo(theSize,0),bgContext.lineTo(theSize,theSize),bgContext.moveTo(0,theSize),bgContext.lineTo(theSize,theSize),bgContext.strokeStyle="#fff",bgContext.stroke(),bgContext.closePath(),b.forEach(function(a,b){bgContext.beginPath(),level[b]={line:[],comp:!1,color:colors_d[b],box:a,soundState:0};var c=boxs[a[0]],d=boxs[a[1]];c.state=2,d.state=2,c.colorIndex=b,d.colorIndex=b;var e=(c.points[0]+c.points[2])/2,f=(c.points[1]+c.points[3])/2,g=(d.points[0]+d.points[2])/2,h=(d.points[1]+d.points[3])/2;bgContext.moveTo(e,f),bgContext.arc(e,f,CircSize,0,2*Math.PI),bgContext.moveTo(g,h),bgContext.arc(g,h,CircSize,0,2*Math.PI),level[b].colorOpc=level[b].color.replace("1)",".2)"),bgContext.fillStyle=level[b].color,bgContext.fill(),bgContext.closePath()}),liCanvas.addEventListener("touchstart",c,!1),liCanvas.addEventListener("touchmove",d,!1)}var bgCanvas,liCanvas,bgContext,liContext,nowLevelNo=-1,nowPackNo=-1,levelCount=0,nowLevelS=0,levelSCount=0,compLevels="",compArray=[],packComp=[],flowjson,allLevels,theSize=550;$(document).ready(function(){}),angular.module("flowApp",["ngCookies","ngResource","ngSanitize","ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/landing.html",controller:"landingCtrl"}).otherwise({redirectTo:"/"})}]).controller("landingCtrl",["$scope",function(){bgCanvas=document.getElementById("bgCanvas"),liCanvas=document.getElementById("liCanvas"),bgContext=bgCanvas.getContext("2d"),liContext=liCanvas.getContext("2d"),liCanvas.addEventListener("touchend",function(a){a.preventDefault(),console.log("touch end"),mouseDown=!1,$("#movesC").html(movesC)},!1),mkGame(6,JSON.parse('[["0","24"],["1","30"],["2","14"],["4","20"],["5","32"],["10","26"]]'))}]);